include ../config.mk
GENERATED = .gitignore openal-soft ogg vorbis alure zlib physfs lua lua-cjson glfw bullet

LICENSE_FILE = LICENSE.txt

HERE = $(shell pwd)
SOURCE = $(shell cd ../src && pwd)
BUILD = $(shell cd ../build && pwd)

all: $(GENERATED)

clean:
	rm -fr $(GENERATED)

.PHONY: all clean

.gitignore:
	echo '# FILE IS GENERATED BY MAKE - DO NOT EDIT' > $@
	for file in $(GENERATED) ; do \
		echo /$$file >> $@ ; \
	done

openal-soft:
	mkdir $@
	cp $(SOURCE)/$@/COPYING $@/$(LICENSE_FILE)
	cp -R $(SOURCE)/$@/include/AL $@/AL
	cp $(BUILD)/$@/OpenAL32$(SHARED_LIBRARY_POSTFIX) $@/

ogg:
	mkdir $@
	mkdir $@/ogg
	cp $(SOURCE)/$@/COPYING $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/include/ogg/*.h $@/ogg/
	cp $(BUILD)/$@/include/ogg/*.h $@/ogg/
	cp $(BUILD)/$@/src/.libs/libogg.a $@/

vorbis:
	mkdir $@
	mkdir $@/vorbis
	cp $(SOURCE)/$@/COPYING $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/include/vorbis/*.h $@/vorbis/
	cp $(BUILD)/$@/lib/.libs/*.a $@/

alure:
	mkdir $@
	cp $(SOURCE)/$@/COPYING $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/include/alext.h $@/
	cp -R $(SOURCE)/$@/include/AL $@/
	cp $(BUILD)/$@/libALURE32-static.a $@/lib$@.a

zlib:
	mkdir $@
	cp zlib-LICENSE.txt $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/*.h $@/
	cp $(BUILD)/$@/*.h $@/
	cp $(BUILD)/$@/libzlibstatic.a $@/lib$@.a

physfs:
	mkdir $@
	cp $(SOURCE)/$@/LICENSE.txt $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/physfs.h $@/
	cp $(BUILD)/$@/libphysfs.a $@/

lua:
	mkdir $@
	cp lua-LICENSE.txt $@/$(LICENSE_FILE)
	cp $(BUILD)/$@/src/*.h $@/
	cp $(BUILD)/$@/src/liblua.a $@/

lua-cjson:
	mkdir $@
	cp $(SOURCE)/$@/LICENSE $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/lua_cjson.h $@/
	cp $(BUILD)/$@/cjson.a $@/lib$@.a

glfw:
	mkdir $@
	cp $(SOURCE)/$@/COPYING.txt $@/$(LICENSE_FILE)
	cp $(SOURCE)/$@/src/*.h $@/
	cp $(BUILD)/$@/src/*.h $@/
	cp $(BUILD)/$@/src/libglfw3.a $@/lib$@.a

bullet:
	mkdir $@
	cp -R $(SOURCE)/$@/src/* $@/
	find $@ -not -type d -and -not -name '*.h' -delete
	rm -rf $@/Bullet3* $@/clew
	cp bullet-LICENSE.txt $@/$(LICENSE_FILE)
	cp $(BUILD)/$@/lib/*.a $@/
